@using LPEditorApp.Models

<UiPanel Title="枠・角丸・影">
    <div class="ui-grid">
        <UiRow Label="枠色">
            <UiColorSwatch Value="Style.BorderColor" ValueChanged="OnBorderColorChanged" />
        </UiRow>
        <UiRow Label="枠幅">
            <UiSelect TValue="int?" Value="Style.BorderWidth" OnChanged="Notify">
                <option value="">なし</option>
                <option value="1">1px</option>
                <option value="2">2px</option>
                <option value="3">3px</option>
                <option value="4">4px</option>
            </UiSelect>
        </UiRow>
        <UiRow Label="角丸">
            <input type="number" class="text" @bind-value="Style.Radius" @bind-value:event="oninput" @bind-value:after="Notify" />
        </UiRow>
        <UiRow Label="影">
            <UiSelect TValue="string" Value="Style.Shadow" OnChanged="Notify">
                <option value="">なし</option>
                <option value="sm">弱</option>
                <option value="md">中</option>
                <option value="lg">強</option>
            </UiSelect>
        </UiRow>
    </div>
</UiPanel>

@code {
    [Parameter] public SectionStyleModel Style { get; set; } = new();
    [Parameter] public EventCallback OnChanged { get; set; }

    protected override void OnParametersSet()
    {
        SyncStyleFromDesign();
    }

    private Task Notify()
    {
        Style.PaddingTop = Style.Layout.PaddingTop;
        Style.PaddingRight = Style.Layout.PaddingRight;
        Style.PaddingBottom = Style.Layout.PaddingBottom;
        Style.PaddingLeft = Style.Layout.PaddingLeft;
        SyncDesignFromStyle();
        return OnChanged.InvokeAsync();
    }

    private async Task OnBorderColorChanged(string? value)
    {
        Style.BorderColor = value ?? string.Empty;
        SyncDesignFromStyle();
        await Notify();
    }

    private void SyncStyleFromDesign()
    {
        if (Style.Design is null)
        {
            return;
        }

        if (!string.IsNullOrWhiteSpace(Style.Design.BorderColor))
        {
            Style.BorderColor = Style.Design.BorderColor!;
        }

        if (Style.Design.BorderWidth.HasValue)
        {
            Style.BorderWidth = Style.Design.BorderWidth;
        }

        if (Style.Design.BorderRadius.HasValue)
        {
            Style.Radius = Style.Design.BorderRadius;
        }

        if (!string.IsNullOrWhiteSpace(Style.Design.ShadowLevel))
        {
            Style.Shadow = string.Equals(Style.Design.ShadowLevel, "off", StringComparison.OrdinalIgnoreCase)
                ? string.Empty
                : Style.Design.ShadowLevel!;
        }
    }

    private void SyncDesignFromStyle()
    {
        Style.Design ??= new SectionDesignModel();
        Style.Design.BorderColor = string.IsNullOrWhiteSpace(Style.BorderColor) ? Style.Design.BorderColor : Style.BorderColor;
        Style.Design.BorderWidth = Style.BorderWidth;
        Style.Design.BorderRadius = Style.Radius;
        Style.Design.ShadowLevel = string.IsNullOrWhiteSpace(Style.Shadow) ? "off" : Style.Shadow;
    }
}
