@using LPEditorApp.Models

<div class="sectionNav-rowWrapper item @(IsHidden ? "is-hidden" : "")" data-id="@Group.Key">
    <div id="@RowId" class="sectionNav-row @(IsCurrent ? "is-current" : "") @(IsSelected ? "is-selected" : "") @(IsOpen ? "is-open" : "")" @onclick="OnSelect">
        <div class="sectionNav-handle drag-handle" title="並び替え" @onclick:stopPropagation="true">⋮⋮</div>
        <div class="sectionNav-icon" title="@IconLabel">@Icon</div>
        <div class="sectionNav-main" @ondblclick="OnToggleOpen">
            <div class="sectionNav-title">@Title</div>
            <div class="sectionNav-sub">
                <span>@SubText</span>
                <span class="sectionNav-id">ID: @Group.Key</span>
            </div>
        </div>
        <div class="sectionNav-actions" @onclick:stopPropagation="true">
            <label class="toggle-switch sectionNav-toggle">
                <input type="checkbox" checked="@IsVisible" @onchange="OnToggleChanged" />
                <span class="toggle-label">表示</span>
            </label>
            <details class="sectionNav-menu" @onclick:stopPropagation="true">
                <summary class="sectionNav-btn" title="クイック操作">⋯</summary>
                <div class="sectionNav-menuList">
                    <button type="button" class="sectionNav-menuItem" @onclick='() => TriggerQuickAction("scroll")'>プレビューへスクロール</button>
                    <button type="button" class="sectionNav-menuItem" @onclick='() => TriggerQuickAction("text")'>本文編集へ移動</button>
                    <button type="button" class="sectionNav-menuItem" @onclick='() => TriggerQuickAction("decor")'>装飾編集へ移動</button>
                    <button type="button" class="sectionNav-menuItem" @onclick='() => TriggerQuickAction("background")'>背景編集へ移動</button>
                    <button type="button" class="sectionNav-menuItem" @onclick='() => TriggerQuickAction("toggle")'>表示/非表示を切替</button>
                </div>
            </details>
            <button type="button" class="sectionNav-btn is-primary" title="編集" @onclick="OnEdit">編集</button>
            <button type="button" class="sectionNav-btn is-danger" title="削除" @onclick='() => OnMenuAction.InvokeAsync("delete")'>削除</button>
        </div>
    </div>
    @if (IsOpen && ChildContent is not null)
    {
        <div class="section-card-body">
            @ChildContent
        </div>
    }
</div>

@code {
    [Parameter] public SectionGroupModel Group { get; set; } = new();
    [Parameter] public string RowId { get; set; } = string.Empty;
    [Parameter] public string Title { get; set; } = string.Empty;
    [Parameter] public string SubText { get; set; } = string.Empty;
    [Parameter] public string Icon { get; set; } = string.Empty;
    [Parameter] public string IconLabel { get; set; } = string.Empty;
    [Parameter] public bool IsCurrent { get; set; }
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public bool IsHidden { get; set; }
    [Parameter] public RenderFragment? ChildContent { get; set; }

    [Parameter] public EventCallback OnSelect { get; set; }
    [Parameter] public EventCallback OnEdit { get; set; }
    [Parameter] public EventCallback<ChangeEventArgs> OnToggleChanged { get; set; }
    [Parameter] public EventCallback OnToggleOpen { get; set; }
    [Parameter] public EventCallback<string> OnQuickAction { get; set; }
    [Parameter] public EventCallback<string> OnMenuAction { get; set; }

    private Task TriggerQuickAction(string action)
        => OnQuickAction.HasDelegate ? OnQuickAction.InvokeAsync(action) : Task.CompletedTask;
}
